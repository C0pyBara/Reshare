# ML Pipeline –¥–ª—è Multilabel –ö–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏–∏ –°–ø–∞–º–∞

## –û–ø–∏—Å–∞–Ω–∏–µ

–°–∏—Å—Ç–µ–º–∞ multilabel –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏–∏ –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –∫–∞—Ç–µ–≥–æ—Ä–∏–π —Å–ø–∞–º–∞ –≤ Telegram –ø–æ—Å—Ç–∞—Ö:
- **ads** (—Ä–µ–∫–ª–∞–º–∞)
- **crypto** (–∫—Ä–∏–ø—Ç–æ–≤–∞–ª—é—Ç—ã, –±–ª–æ–∫—á–µ–π–Ω)
- **scam** (–º–æ—à–µ–Ω–Ω–∏—á–µ—Å—Ç–≤–æ)
- **casino** (–∫–∞–∑–∏–Ω–æ, —Å—Ç–∞–≤–∫–∏)

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

```
Telegram —Å–æ–æ–±—â–µ–Ω–∏–µ
  ‚Üì
Heuristics (–±—ã—Å—Ç—Ä–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞, score <= 2 –∏–ª–∏ >= 8 ‚Üí —Ä–µ—à–µ–Ω–∏–µ)
  ‚Üì
ML Classifier (TF-IDF + Meta Features + OneVsRest LR)
  ‚Üì
LLM (—Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ ML –Ω–µ —É–≤–µ—Ä–µ–Ω–∞: prob ‚àà [0.4, 0.6])
```

## –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### 1. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

```bash
pip install -r requirements.txt
```

### 2. –°–±–æ—Ä –¥–∞–Ω–Ω—ã—Ö

–ë–æ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ª–æ–≥–∏—Ä—É–µ—Ç –≤—Å–µ —Å–æ–æ–±—â–µ–Ω–∏—è –≤ `data/raw_messages.jsonl`

### 3. –†–∞–∑–º–µ—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö

```bash
python label_data_ml.py
```

–ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–∞—è —Ä–∞–∑–º–µ—Ç–∫–∞ —Å –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–π –ø–æ–º–æ—â—å—é LLM –¥–ª—è –ø–µ—Ä–≤–∏—á–Ω–æ–π —Ä–∞–∑–º–µ—Ç–∫–∏.

**–§–æ—Ä–º–∞—Ç –¥–∞—Ç–∞—Å–µ—Ç–∞ (multilabel CSV):**
```csv
text,ads,crypto,scam,casino
"üî• –ò–Ω–≤–µ—Å—Ç–∏—Ä—É–π –≤ —Ç–æ–∫–µ–Ω",1,1,0,0
"–ö–∞–∑–∏–Ω–æ —Å –±–æ–Ω—É—Å–æ–º",1,0,0,1
"–°—Ö–µ–º–∞ –±—ã—Å—Ç—Ä–æ–≥–æ –∑–∞—Ä–∞–±–æ—Ç–∫–∞",1,1,1,0
```

### 4. –û–±—É—á–µ–Ω–∏–µ –º–æ–¥–µ–ª–∏

```bash
python train_ml_multilabel.py
```

–ú–æ–¥–µ–ª—å –±—É–¥–µ—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞ –≤ `models/spam_ml_multilabel.pkl`

**–ú–µ—Ç—Ä–∏–∫–∏ –¥–ª—è production:**
- ads: recall ‚â• 0.90, precision ‚â• 0.85
- crypto: recall ‚â• 0.85, precision ‚â• 0.80
- scam: recall ‚â• 0.95, precision ‚â• 0.75 (recall –≤–∞–∂–Ω–µ–µ!)
- casino: recall ‚â• 0.90, precision ‚â• 0.85

### 5. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤ –∫–æ–¥–µ

```python
from spam_pipeline_multilabel import SpamMultilabelPipeline
import asyncio

pipeline = SpamMultilabelPipeline()

async def classify(text):
    result = await pipeline.classify_async(text)
    print(f"–ú–µ—Ç–∫–∏: {result['labels']}")
    print(f"–ú–µ—Ç–æ–¥: {result['method']}")
    print(f"–£–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å: {result['confidence']}")

# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ
asyncio.run(classify("üî• –°–∫–∏–¥–∫–∞ 50% –Ω–∞ —Ç–æ–∫–µ–Ω—ã!"))
```

## –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏

### Telegram-—Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ —Ñ–∏—á–∏

–ú–æ–¥–µ–ª—å –∏—Å–ø–æ–ª—å–∑—É–µ—Ç 19 –º–µ—Ç–∞-–ø—Ä–∏–∑–Ω–∞–∫–æ–≤:
- –°—Ç—Ä—É–∫—Ç—É—Ä–Ω—ã–µ (–¥–ª–∏–Ω–∞, —Å—Ç—Ä–æ–∫–∏, CAPS ratio)
- –°—Å—ã–ª–∫–∏ (URL, –∫–æ—Ä–æ—Ç–∫–∏–µ –¥–æ–º–µ–Ω—ã, t.me)
- –ú–∞—Ä–∫–µ—Ç–∏–Ω–≥–æ–≤—ã–µ (–ø—Ä–æ—Ü–µ–Ω—Ç—ã, –≤–∞–ª—é—Ç—ã, –ø—Ä–æ–º–æ–∫–æ–¥—ã)
- –≠–º–æ–¥–∑–∏ –∏ —Å–∏–º–≤–æ–ª—ã
- –ö–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞ –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º

### Active Learning

LLM –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –¥–ª—è –Ω–µ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã—Ö —Å–ª—É—á–∞–µ–≤ (prob ‚àà [0.4, 0.6]).
–í—Å–µ —Ç–∞–∫–∏–µ —Å–ª—É—á–∞–∏ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ `data/active_learning_data.jsonl` –¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è –º–æ–¥–µ–ª–∏.

### –ü–æ—Ä–æ–≥–∏ –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏–∏

–ù–∞—Å—Ç—Ä–∞–∏–≤–∞—é—Ç—Å—è –≤ `train_ml_multilabel.py`:
```python
THRESHOLDS = {
    "ads": 0.4,
    "crypto": 0.4,
    "scam": 0.3,  # –ù–∏–∂–µ –ø–æ—Ä–æ–≥ –¥–ª—è scam (–≤–∞–∂–Ω–µ–µ recall)
    "casino": 0.4
}
```

## –§–∞–π–ª—ã

- `label_data_ml.py` - –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –¥–ª—è multilabel —Ä–∞–∑–º–µ—Ç–∫–∏
- `train_ml_multilabel.py` - –æ–±—É—á–µ–Ω–∏–µ multilabel –º–æ–¥–µ–ª–∏
- `ml_model_multilabel.py` - –∫–ª–∞—Å—Å ML –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ç–æ—Ä–∞
- `spam_pipeline_multilabel.py` - —Ñ–∏–Ω–∞–ª—å–Ω—ã–π pipeline —Å active learning
- `telegram_features.py` - –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ Telegram-—Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã—Ö –ø—Ä–∏–∑–Ω–∞–∫–æ–≤
- `data_logger.py` - –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏–π –¥–ª—è –¥–∞—Ç–∞—Å–µ—Ç–∞

## –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

1. **–ú–∏–Ω–∏–º—É–º –¥–∞–Ω–Ω—ã—Ö:** 300-500 —Ä–∞–∑–º–µ—á–µ–Ω–Ω—ã—Ö –ø—Ä–∏–º–µ—Ä–æ–≤
2. **–ü–µ—Ä–µ–æ–±—É—á–µ–Ω–∏–µ:** –†–∞–∑ –≤ 1-2 –Ω–µ–¥–µ–ª–∏ –∏–ª–∏ –ø–æ—Å–ª–µ 500 –Ω–æ–≤—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π
3. **–ö–æ–Ω—Ç—Ä–æ–ª—å –º–µ—Ç—Ä–∏–∫:** –†–µ–≥—É–ª—è—Ä–Ω–æ –ø—Ä–æ–≤–µ—Ä—è–π—Ç–µ recall –¥–ª—è scam (–∫—Ä–∏—Ç–∏—á–Ω–æ!)
4. **–ë–∞–ª–∞–Ω—Å –∫–ª–∞—Å—Å–æ–≤:** –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `class_weight="balanced"` –≤ LogisticRegression
5. **–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–æ—Ä–æ–≥–æ–≤:** –ü–æ–¥–±–∏—Ä–∞–π—Ç–µ –ø–æ—Ä–æ–≥–∏ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∫–ª–∞—Å—Å–∞ –æ—Ç–¥–µ–ª—å–Ω–æ

