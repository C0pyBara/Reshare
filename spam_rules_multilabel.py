"""
–ú—É–ª—å—Ç–∏–º–µ—Ç–æ—á–Ω–∞—è —ç–≤—Ä–∏—Å—Ç–∏–∫–∞ –¥–ª—è –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏–∏ –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º:
- ads (—Ä–µ–∫–ª–∞–º–∞)
- crypto (–∫—Ä–∏–ø—Ç–∞)
- scam (—Å–∫–∞–º)
- casino (–∫–∞–∑–∏–Ω–æ)
"""
import re
from typing import Dict

# –ö–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞ –¥–ª—è –∫–∞–∂–¥–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
CATEGORY_KEYWORDS = {
    "ads": {
        "words": [
            # –û—Å–Ω–æ–≤–Ω—ã–µ —Ä–µ–∫–ª–∞–º–Ω—ã–µ —Å–ª–æ–≤–∞
            "–≤–µ–±–∏–Ω–∞—Ä", "–∏–Ω—Ç–µ–Ω—Å–∏–≤", "–º–∞—Ä–∞—Ñ–æ–Ω", "—á–µ–∫-–ª–∏—Å—Ç", "—Å–∫–∏–¥–∫–∞", "—Å–∫–∏–¥–∫–∏", "–∞–∫—Ü–∏—è", 
            "–∫—É–ø–∏—Ç—å", "–∑–∞–∫–∞–∑–∞—Ç—å", "–ø—Ä–∞–π—Å", "–ø—Ä–æ–º–æ–∫–æ–¥", "–ø—Ä–æ–º–æ", "–ø—Ä–æ–º–æ-–∫–æ–¥", "–±–æ–Ω—É—Å", "sale",
            "–ø–æ–¥–ø–∏—à–∏—Å—å", "–∑–∞–∫—Ä–µ–ø–µ", "–ø–µ—Ä–µ—Ö–æ–¥–∏", "–∑–∞–±–∏—Ä–∞–π", "–∂–º–∏", "—Å—Å—ã–ª–∫–∞",
            "–≤—Ö–æ–¥", "—á–∏—Ç–∞—Ç—å –¥–∞–ª–µ–µ", "–º–µ—Å—Ç –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–æ", "—É—Å–ø–µ–π",
            # –°–∫–∏–¥–∫–∏ –∏ –∞–∫—Ü–∏–∏
            "-50%", "–¥–æ -50%", "—Å–∫–∏–¥–∫–∞ –¥–æ", "% —Å–∫–∏–¥–∫–∞",
            "—Ä–∞—Å–ø—Ä–æ–¥–∞–∂–∞", "—Ä–∞—Å–ø—Ä–æ–¥–∞–∂–∏", "—Å—Ç–æ–∫",
            # –ü—Ä–æ–º–æ–∫–æ–¥—ã –∏ –∫—É–ø–æ–Ω—ã
            "–∫—É–ø–æ–Ω", "–ø—Ä–æ–º–æ–∫–æ–¥", "–ø—Ä–æ–º–æ", "–ø—Ä–æ–º–æ-–∫–æ–¥",
            # –ë–µ—Å–ø–ª–∞—Ç–Ω—ã–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è
            "–±–µ—Å–ø–ª–∞—Ç–Ω–æ", "–¥–∞—Ä–∏–º", "–≤ –ø–æ–¥–∞—Ä–æ–∫", "–ø–æ–¥–∞—Ä–æ–∫",
            # –î–æ—Å—Ç–∞–≤–∫–∞
            "–¥–æ—Å—Ç–∞–≤–∫–∞", "–±–µ—Å–ø–ª–∞—Ç–Ω–∞—è –¥–æ—Å—Ç–∞–≤–∫–∞", "–∫—É—Ä—å–µ—Ä–æ–º",
            # –ü—Ä–∏–∑—ã–≤—ã –∫ –¥–µ–π—Å—Ç–≤–∏—é
            "–ø–æ–∫—É–ø–∞–π", "–∫—É–ø–∏", "–æ—Ñ–æ—Ä–º–∏", "–æ—Ñ–æ—Ä–º–ª—è–π—Ç–µ –∑–∞–∫–∞–∑",
            # –û–ø–ª–∞—Ç–∞
            "–æ–ø–ª–∞—Ç–∞", "–æ–ø–ª–∞—Ç–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏", "–æ–ø–ª–∞—Ç–∞ –æ–Ω–ª–∞–π–Ω",
            # –û–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω—ã–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è
            "–∞–∫—Ü–∏—è —Ç–æ–ª—å–∫–æ", "—Ç–æ–ª—å–∫–æ —Å–µ–≥–æ–¥–Ω—è", "–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω–æ–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ",
            # –ù–æ–≤–∏–Ω–∫–∏ –∏ —ç–∫—Å–∫–ª—é–∑–∏–≤—ã
            "–Ω–æ–≤—ã–π", "–Ω–æ–≤–∏–Ω–∫–∞", "—ç–∫—Å–∫–ª—é–∑–∏–≤", "—É–Ω–∏–∫–∞–ª—å–Ω–æ",
            # –í—ã–≥–æ–¥–Ω—ã–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è
            "–≤—ã–≥–æ–¥–Ω–æ", "–ª—É—á—à–∞—è —Ü–µ–Ω–∞", "–Ω–µ–≤–µ—Ä–æ—è—Ç–Ω–æ –≤—ã–≥–æ–¥–Ω–æ",
            # –ì–∞—Ä–∞–Ω—Ç–∏–∏
            "–≥–∞—Ä–∞–Ω—Ç–∏—è", "–≤–æ–∑–≤—Ä–∞—Ç", "–æ–±–º–µ–Ω",
            # –ü–æ–¥–ø–∏—Å–∫–∏
            "–ø–æ–¥–ø–∏—Å—ã–≤–∞–π—Ç–µ—Å—å", "–ø–æ–¥–ø–∏—Å–∫–∞", "–∫–∞–Ω–∞–ª", "—Ç–µ–ª–µ–≥—Ä–∞–º-–∫–∞–Ω–∞–ª",
            # –°—Å—ã–ª–∫–∏
            "–ø–æ —Å—Å—ã–ª–∫–µ", "–ø–µ—Ä–µ–π—Ç–∏ –ø–æ —Å—Å—ã–ª–∫–µ", "–≤ –ø—Ä–æ—Ñ–∏–ª–µ",
            # –ö–æ–Ω—Ç–∞–∫—Ç—ã
            "–∑–≤–æ–Ω–∏—Ç–µ", "whatsapp", "viber", "telegram:",
            # –¶–µ–Ω—ã –∏ –≤–∞–ª—é—Ç—ã
            "—Ü–µ–Ω–∞", "—Ä—É–±.", "‚ÇΩ", "$", "–≥—Ä–Ω", "–≥—Ä–Ω.", "–æ—Ç 999", "–≤—Å–µ–≥–æ 499",
            # –û–ø—Ç –∏ –±–∏–∑–Ω–µ—Å
            "–æ–ø—Ç–æ–º", "–ø–∞—Ä—Ç–∏—è–º–∏", "–¥–ª—è –±–∏–∑–Ω–µ—Å–∞", "—Å–æ—Ç—Ä—É–¥–Ω–∏—á–µ—Å—Ç–≤–æ",
            # –ë–æ–Ω—É—Å—ã –∏ –∫–µ—à–±–µ–∫
            "–∫–µ—à–±–µ–∫", "–Ω–∞—á–∏—Å–ª—è–µ–º", "–±–∞–ª–ª—ã", "–Ω–∞—á–∏—Å–ª–µ–Ω–∏—è",
            # –¢–µ—Å—Ç—ã –∏ –¥–µ–º–æ
            "—Ç–µ—Å—Ç-–¥—Ä–∞–π–≤", "–¥–µ–º–æ", "–ø—Ä–æ–±–Ω—ã–π –ø–µ—Ä–∏–æ–¥", "–±–µ—Å–ø–ª–∞—Ç–Ω–æ –Ω–∞ –ø—Ä–æ–±—É",
            # –†–µ—Ñ–µ—Ä–∞–ª—å–Ω—ã–µ –ø—Ä–æ–≥—Ä–∞–º–º—ã
            "–ø–∞—Ä—Ç–Ω–µ—Ä—Å–∫–∞—è —Å—Å—ã–ª–∫–∞", "—Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è —Å—Å—ã–ª–∫–∞", "—Ä–µ—Ñ–µ—Ä–∞–ª"
        ],
        "weight": 1.0
    },
    "crypto": {
        "words": [
            "p2p", "–∞—Ä–±–∏—Ç—Ä–∞–∂", "–ø—Ä–æ—Ñ–∏—Ç", "–∏–∫—Å—ã", "–∞–∏—Ä–¥—Ä–æ–ø", "–ª–∏—Å—Ç–∏–Ω–≥",
            "–∫—Ä–∏–ø—Ç–∞", "—Ç–æ–∫–µ–Ω", "–±–ª–æ–∫—á–µ–π–Ω", "–º–∞–π–Ω–∏–Ω–≥", "btc", "eth", "usdt",
            "–±–∏—Ä–∂–∞", "–æ–±–º–µ–Ω–Ω–∏–∫", "–∫–æ—à–µ–ª–µ–∫", "–¥–µ–ø–æ–∑–∏—Ç", "–≤—ã–≤–æ–¥"
        ],
        "weight": 1.0
    },
    "scam": {
        "words": [
            "—Å–∫–∞–º", "–º–æ—à–µ–Ω–Ω–∏–∫", "–æ–±–º–∞–Ω", "—Å—Ö–µ–º–∞ –∑–∞—Ä–∞–±–æ—Ç–∫–∞", "–±—ã—Å—Ç—Ä—ã–π –¥–æ—Ö–æ–¥",
            "–≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–π", "–±–µ–∑ —Ä–∏—Å–∫–∞", "100% –ø—Ä–∏–±—ã–ª—å", "–ª–µ–≥–∫–∏–µ –¥–µ–Ω—å–≥–∏",
            "—Ä–∞–±–æ—Ç–∞ –Ω–∞ –¥–æ–º—É", "–∑–∞—Ä–∞–±–æ—Ç–æ–∫ –±–µ–∑ –≤–ª–æ–∂–µ–Ω–∏–π"
        ],
        "weight": 1.0
    },
    "casino": {
        "words": [
            "–∫–∞–∑–∏–Ω–æ", "—Å—Ç–∞–≤–∫–∏", "–≤—ã–∏–≥—Ä—ã—à", "—Å–ª–æ—Ç—ã", "—Ä—É–ª–µ—Ç–∫–∞", "–¥–∂–µ–∫–ø–æ—Ç",
            "–±–æ–Ω—É—Å –∑–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é", "—Ñ—Ä–∏—Å–ø–∏–Ω—ã", "—Å—Ç–∞–≤–∫–∞", "—Ç–æ—Ç–∞–ª–∏–∑–∞—Ç–æ—Ä",
            "–±—É–∫–º–µ–∫–µ—Ä", "–±–µ—Ç", "–≤–∏–ª–∫–∞"
        ],
        "weight": 1.0
    }
}

# –ü–∞—Ç—Ç–µ—Ä–Ω—ã –¥–ª—è –∫–∞–∂–¥–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
CATEGORY_PATTERNS = {
    "ads": [
        # –ë–∞–∑–æ–≤—ã–µ –ø–∞—Ç—Ç–µ—Ä–Ω—ã
        r"–º–µ—Å—Ç(?:–∞)? –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–æ",
        r"–≤—Ö–æ–¥ —Ç–æ–ª—å–∫–æ –¥–ª—è",
        r"—á–∏—Ç–∞—Ç—å (?:–ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏–µ|–¥–∞–ª–µ–µ)",
        r"—É—Å–ø–µ–π (?:–∑–∞–±—Ä–∞—Ç—å|–≤—Å—Ç—É–ø–∏—Ç—å|–∫—É–ø–∏—Ç—å)",
        r"–∑–∞–≥–ª—è–Ω–∏ –≤ –∑–∞–∫—Ä–µ–ø",
        r"–Ω–∞ –ø—Ä–∞–≤–∞—Ö —Ä–µ–∫–ª–∞–º—ã",
        r"–≤—ã–ª–æ–∂–∏–ª –≤ –∑–∞–∫—Ä—ã—Ç—ã–π",
        r"—Ü–µ–Ω–∞ —Å–Ω–∏–∂–µ–Ω–∞",
        # URL –∏ —Å—Å—ã–ª–∫–∏
        r"https?://\S+",
        r"t\.me/\S+",
        r"bit\.ly/\S+",
        r"goo\.gl/\S+",
        r"clck\.ru/\S+",
        r"short\.link/\S+",
        # –¢–µ–ª–µ—Ñ–æ–Ω–Ω—ã–µ –Ω–æ–º–µ—Ä–∞ (–∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ —Ä–µ–≥—É–ª—è—Ä–Ω—ã–µ –≤—ã—Ä–∞–∂–µ–Ω–∏—è)
        r"\+?\d[\d\s\-()]{6,}\d",
        r"\+7[\s\-]?\(?\d{3}\)?[\s\-]?\d{3}[\s\-]?\d{2}[\s\-]?\d{2}",
        r"\+380[\s\-]?\d{2}[\s\-]?\d{3}[\s\-]?\d{2}[\s\-]?\d{2}",
        r"\+?\d{1,3}[\s\-]?\(?\d{3,4}\)?[\s\-]?\d{2,3}[\s\-]?\d{2}[\s\-]?\d{2}",
        # –ü—Ä–æ—Ü–µ–Ω—Ç—ã –∏ —Å–∫–∏–¥–∫–∏
        r"\b\d{1,3}%",
        r"\b-?\d{1,3}%",
        r"\b—Å–∫–∏–¥–∫\w+",
        r"—Å–∫–∏–¥–∫–∞\s+–¥–æ\s+\d+%",
        r"–¥–æ\s+-?\d+%",
        # –í–∞–ª—é—Ç—ã –∏ —Ü–µ–Ω—ã
        r"\b\d{1,3}([ ,]\d{3})*([,.]\d+)?\s?(‚ÇΩ|—Ä—É–±|—Ä—É–±\.)",
        r"\b\d+\s?(‚Ç¥|–≥—Ä–Ω|–≥—Ä–Ω\.)",
        r"\$\d+",
        r"–æ—Ç\s+\d+",
        r"–≤—Å–µ–≥–æ\s+\d+",
        # N-grams (2-3 —Å–ª–æ–≤–∞)
        r"—Å–∫–∏–¥–∫–∞\s+–¥–æ",
        r"–±–µ—Å–ø–ª–∞—Ç–Ω–∞—è\s+–¥–æ—Å—Ç–∞–≤–∫–∞",
        r"—Ç–æ–ª—å–∫–æ\s+—Å–µ–≥–æ–¥–Ω—è",
        r"–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω–æ–µ\s+–ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ",
        r"—Ç–æ–ª—å–∫–æ\s+–¥–ª—è\s+–≤–∞—Å",
        r"–ø–æ\s+–ø—Ä–æ–º–æ–∫–æ–¥—É",
        r"–ø–æ–ª—É—á–∏\s+–≤\s+–ø–æ–¥–∞—Ä–æ–∫",
        r"–ø–µ—Ä–µ–π—Ç–∏\s+–ø–æ\s+—Å—Å—ã–ª–∫–µ",
        r"—Å–≤—è–∑–∞—Ç—å—Å—è\s+–≤\s+—Ç–µ–ª–µ–≥—Ä–∞–º",
        r"–æ—Ñ–æ—Ä–º–∏—Ç—å\s+–∑–∞–∫–∞–∑",
        r"—Ç–æ–ª—å–∫–æ\s+\d+\s+–¥–Ω—è",
        r"–¥–æ\s+–∫–æ–Ω—Ü–∞\s+–Ω–µ–¥–µ–ª–∏",
        r"–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–æ",
        r"–¥–ª—è\s+–ø–µ—Ä–≤—ã—Ö\s+\d+",
        r"–∫–æ–ª–∏—á–µ—Å—Ç–≤–æ\s+–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–æ",
        # –°—Ä–æ–∫–∏ –∏ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è
        r"—Ç–æ–ª—å–∫–æ\s+\d+\s+–¥–Ω—è",
        r"–¥–æ\s+–∫–æ–Ω—Ü–∞\s+–Ω–µ–¥–µ–ª–∏",
        r"—Ç–æ–ª—å–∫–æ\s+—Å–µ–≥–æ–¥–Ω—è",
        r"—Ç–æ–ª—å–∫–æ\s+–∑–∞–≤—Ç—Ä–∞",
        r"–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω–æ–µ\s+–≤—Ä–µ–º—è",
        # –£—Å–ª–æ–≤–∏—è
        r"—Å–∫–∏–¥–∫–∞\s+–ø—Ä–∏\s+–ø–æ–¥–ø–∏—Å–∫–µ",
        r"–ø—Ä–æ–º–æ–∫–æ–¥\s+–ø—Ä–∏\s+–ø–æ–∫—É–ø–∫–µ",
        r"–±–æ–Ω—É—Å\s+–ø—Ä–∏\s+–∑–∞–∫–∞–∑–µ"
    ],
    "crypto": [
        r"p2p[\s-]?–æ–±–º–µ–Ω",
        r"–∞—Ä–±–∏—Ç—Ä–∞–∂[\s-]?–∫—Ä–∏–ø—Ç",
        r"–∞–∏—Ä–¥—Ä–æ–ø[\s-]?—Ç–æ–∫–µ–Ω",
        r"–ª–∏—Å—Ç–∏–Ω–≥[\s-]?–Ω–∞[\s-]?–±–∏—Ä–∂"
    ],
    "scam": [
        r"–≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω(?:—ã–π|–∞—è) (?:–ø—Ä–∏–±—ã–ª—å|–¥–æ—Ö–æ–¥)",
        r"–±–µ–∑ (?:—Ä–∏—Å–∫|–≤–ª–æ–∂–µ–Ω–∏–π)",
        r"100% (?:–ø—Ä–∏–±—ã–ª—å|–¥–æ—Ö–æ–¥)",
        r"–ª–µ–≥–∫(?:–∏–µ|–∏–π) (?:–¥–µ–Ω—å–≥–∏|–∑–∞—Ä–∞–±–æ—Ç–æ–∫)"
    ],
    "casino": [
        r"–±–æ–Ω—É—Å –∑–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é",
        r"—Ñ—Ä–∏—Å–ø–∏–Ω",
        r"–¥–∂–µ–∫–ø–æ—Ç",
        r"—Å—Ç–∞–≤–∫(?:–∏|–∞) –Ω–∞ (?:—Å–ø–æ—Ä—Ç|—Å–æ–±—ã—Ç–∏—è)"
    ]
}

# –°—Ç—Ä—É–∫—Ç—É—Ä–Ω—ã–µ –ø—Ä–∏–∑–Ω–∞–∫–∏ (—Å—Å—ã–ª–∫–∏, –∫–∞–ø—Å, —ç–º–æ–¥–∑–∏)
def _analyze_structure(text: str) -> Dict[str, float]:
    """–ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä–Ω—ã–µ –ø—Ä–∏–∑–Ω–∞–∫–∏ —Ç–µ–∫—Å—Ç–∞."""
    text_lower = text.lower()
    
    # –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å—Å—ã–ª–æ–∫
    links_count = len(re.findall(r"https?://|t\.me/", text_lower))
    
    # –î–æ–ª—è –∑–∞–≥–ª–∞–≤–Ω—ã—Ö –±—É–∫–≤
    upper_ratio = sum(1 for c in text if c.isupper()) / len(text) if len(text) > 0 else 0
    
    # –ü–ª–æ—Ç–Ω–æ—Å—Ç—å —ç–º–æ–¥–∑–∏
    emoji_count = len(re.findall(r'[^\w\s,.!?]', text))
    emoji_density = emoji_count / len(text) if len(text) > 0 else 0
    
    return {
        "links": links_count,
        "caps_ratio": upper_ratio,
        "emoji_density": emoji_density
    }


def heuristic_multilabel_score(text: str) -> Dict[str, float]:
    """
    –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –æ—Ü–µ–Ω–∫–∏ –¥–ª—è –∫–∞–∂–¥–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ (0.0 - 1.0).
    
    Returns:
        Dict —Å –∫–ª—é—á–∞–º–∏: "ads", "crypto", "scam", "casino"
    """
    if not text:
        return {"ads": 0.0, "crypto": 0.0, "scam": 0.0, "casino": 0.0}
    
    text_lower = text.lower()
    scores = {category: 0.0 for category in CATEGORY_KEYWORDS.keys()}
    
    # 1. –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–ª—é—á–µ–≤—ã—Ö —Å–ª–æ–≤
    for category, data in CATEGORY_KEYWORDS.items():
        for word in data["words"]:
            if word in text_lower:
                scores[category] += data["weight"]
    
    # 2. –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤ (—Ü–µ–ª—ã—Ö —Ñ—Ä–∞–∑)
    for category, patterns in CATEGORY_PATTERNS.items():
        for pattern in patterns:
            if re.search(pattern, text_lower):
                scores[category] += 3.0  # –ü–∞—Ç—Ç–µ—Ä–Ω—ã - —Å–∏–ª—å–Ω—ã–π –º–∞—Ä–∫–µ—Ä
    
    # 3. –°—Ç—Ä—É–∫—Ç—É—Ä–Ω—ã–µ –ø—Ä–∏–∑–Ω–∞–∫–∏ (–ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è –∫–æ –≤—Å–µ–º –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º, –Ω–æ —Å —Ä–∞–∑–Ω—ã–º–∏ –≤–µ—Å–∞–º–∏)
    structure = _analyze_structure(text)
    
    # –°—Å—ã–ª–∫–∏ - –ø—Ä–∏–∑–Ω–∞–∫ —Ä–µ–∫–ª–∞–º—ã
    if structure["links"] > 0:
        scores["ads"] += structure["links"] * 2.5
    
    # –¢–µ–ª–µ—Ñ–æ–Ω–Ω—ã–µ –Ω–æ–º–µ—Ä–∞ - –ø—Ä–∏–∑–Ω–∞–∫ —Ä–µ–∫–ª–∞–º—ã
    phones_count = structure.get("phones", 0)
    if phones_count > 0:
        scores["ads"] += phones_count * 2.0
    
    # –ö–∞–ø—Å - –ø—Ä–∏–∑–Ω–∞–∫ —Ä–µ–∫–ª–∞–º—ã –∏ —Å–∫–∞–º–∞
    if structure["caps_ratio"] > 0.3 and len(text) > 20:
        scores["ads"] += 2.0
        scores["scam"] += 1.0
    
    # –≠–º–æ–¥–∑–∏ - –ø—Ä–∏–∑–Ω–∞–∫ —Ä–µ–∫–ª–∞–º—ã
    if structure["emoji_density"] > 0.1:
        scores["ads"] += 1.5
    
    # –í–æ—Å–∫–ª–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–µ –∑–Ω–∞–∫–∏ - –ø—Ä–∏–∑–Ω–∞–∫ —Ä–µ–∫–ª–∞–º—ã
    if structure["exclamation_density"] > 0.05:
        scores["ads"] += 1.0
    
    # –ü—Ä–æ—Ü–µ–Ω—Ç—ã –∏ –≤–∞–ª—é—Ç—ã - –ø—Ä–∏–∑–Ω–∞–∫ —Ä–µ–∫–ª–∞–º—ã
    percent_count = structure.get("percent_count", 0)
    currency_count = structure.get("currency_count", 0)
    if percent_count > 0:
        scores["ads"] += percent_count * 1.0
    if currency_count > 0:
        scores["ads"] += currency_count * 1.0
    
    # –ü–æ–≤—Ç–æ—Ä –∫–ª—é—á–µ–≤—ã—Ö —Å–ª–æ–≤ - –ø—Ä–∏–∑–Ω–∞–∫ —Ä–µ–∫–ª–∞–º—ã
    keyword_repeats = structure.get("keyword_repeats", 0)
    if keyword_repeats > 2:
        scores["ads"] += (keyword_repeats - 2) * 0.5
    
    # –ù–æ—Ä–º–∞–ª–∏–∑—É–µ–º –≤—Å–µ –æ—Ü–µ–Ω–∫–∏ –≤ –¥–∏–∞–ø–∞–∑–æ–Ω 0.0 - 1.0
    # –ò—Å–ø–æ–ª—å–∑—É–µ–º —Å–∏–≥–º–æ–∏–¥—É –¥–ª—è –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏–∏
    for category in scores:
        raw_score = scores[category]
        # –ù–æ—Ä–º–∞–ª–∏–∑—É–µ–º: score / (score + 5) –¥–∞–µ—Ç –ø–ª–∞–≤–Ω—É—é –∫—Ä–∏–≤—É—é –æ—Ç 0 –¥–æ 1
        normalized = min(1.0, raw_score / (raw_score + 5.0))
        scores[category] = normalized
    
    return scores


def heuristic_multilabel_predict(text: str, thresholds: Dict[str, float] = None) -> Dict[str, int]:
    """
    –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –±–∏–Ω–∞—Ä–Ω—ã–µ –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏—è –¥–ª—è –∫–∞–∂–¥–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ (0 –∏–ª–∏ 1).
    
    Args:
        text: –¢–µ–∫—Å—Ç –¥–ª—è –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏–∏
        thresholds: –ü–æ—Ä–æ–≥–∏ –¥–ª—è –∫–∞–∂–¥–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 0.4)
    
    Returns:
        Dict —Å –∫–ª—é—á–∞–º–∏: "ads", "crypto", "scam", "casino" (–∑–Ω–∞—á–µ–Ω–∏—è 0 –∏–ª–∏ 1)
    """
    if thresholds is None:
        thresholds = {
            "ads": 0.4,
            "crypto": 0.3,
            "scam": 0.2,  # –ù–∏–∂–µ –ø–æ—Ä–æ–≥ –¥–ª—è —Å–∫–∞–º–∞ (–≤—ã—à–µ recall)
            "casino": 0.3
        }
    
    scores = heuristic_multilabel_score(text)
    predictions = {}
    
    for category in scores:
        predictions[category] = 1 if scores[category] >= thresholds.get(category, 0.4) else 0
    
    return predictions


# –û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å: —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –µ–¥–∏–Ω–æ–π –æ—Ü–µ–Ω–∫–∏ —Å–ø–∞–º–∞
def heuristic_spam_score(text: str) -> float:
    """
    –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –µ–¥–∏–Ω—É—é –æ—Ü–µ–Ω–∫—É —Å–ø–∞–º–∞ (0.0 - 10.0+).
    –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –æ–±—Ä–∞—Ç–Ω–æ–π —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏.
    """
    scores = heuristic_multilabel_score(text)
    # –ë–µ—Ä–µ–º –º–∞–∫—Å–∏–º–∞–ª—å–Ω—É—é –æ—Ü–µ–Ω–∫—É –∏–∑ –≤—Å–µ—Ö –∫–∞—Ç–µ–≥–æ—Ä–∏–π –∏ —É–º–Ω–æ–∂–∞–µ–º –Ω–∞ 10
    max_score = max(scores.values())
    return max_score * 10.0


# –ê–ª–∏–∞—Å –¥–ª—è –æ–±—Ä–∞—Ç–Ω–æ–π —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏
improved_heuristic_score = heuristic_spam_score


if __name__ == "__main__":
    # –¢–µ—Å—Ç—ã
    test_cases = [
        "üî• –£–°–ü–ï–ô –ó–ê–ë–†–ê–¢–¨! –ú–µ—Å—Ç –æ—Å—Ç–∞–ª–æ—Å—å –º–∞–ª–æ. –ú–æ—è —Å–µ–∫—Ä–µ—Ç–Ω–∞—è —Å—Ç—Ä–∞—Ç–µ–≥–∏—è p2p –∞—Ä–±–∏—Ç—Ä–∞–∂–∞ –≤ –∑–∞–∫—Ä–µ–ø–µ: t.me/link",
        "–ù–æ–≤–æ–µ –∫–∞–∑–∏–Ω–æ —Å –±–æ–Ω—É—Å–æ–º –∑–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é! –§—Ä–∏—Å–ø–∏–Ω—ã –∏ –¥–∂–µ–∫–ø–æ—Ç –∂–¥—É—Ç –≤–∞—Å!",
        "–ì–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –¥–æ—Ö–æ–¥ –±–µ–∑ —Ä–∏—Å–∫–∞! –°—Ö–µ–º–∞ –∑–∞—Ä–∞–±–æ—Ç–∫–∞ –Ω–∞ –∫—Ä–∏–ø—Ç–µ. –ë—ã—Å—Ç—Ä—ã–µ –¥–µ–Ω—å–≥–∏!",
        "–û–±—ã—á–Ω–∞—è –Ω–æ–≤–æ—Å—Ç—å –æ —Å–æ–±—ã—Ç–∏—è—Ö –≤ –≥–æ—Ä–æ–¥–µ. –ù–∏—á–µ–≥–æ –æ—Å–æ–±–µ–Ω–Ω–æ–≥–æ."
    ]
    
    for text in test_cases:
        print(f"\n–¢–µ–∫—Å—Ç: {text[:60]}...")
        scores = heuristic_multilabel_score(text)
        predictions = heuristic_multilabel_predict(text)
        print(f"–û—Ü–µ–Ω–∫–∏: {scores}")
        print(f"–ü—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏—è: {predictions}")

